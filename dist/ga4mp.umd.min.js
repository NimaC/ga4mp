!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ga4mp=t()}(this,(function(){"use strict";var e=function(e,t){return"string"==typeof e?e.substring(0,t):e},t=function(e){return!!e&&("[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e))},n=function(e){return"number"==typeof e&&!isNaN(e)},i=function(){return Math.floor(2147483648*Math.random()+0)},a=function(){return Math.floor(1*new Date/1e3)},o=function(){var e;return"undefined"!=="object".document?e="browser":"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node&&(e="node"),e},r=function(t,i){try{t=t.toString()}catch(e){}return function(e){return null!=e&&"string"==typeof e}(t)&&i&&n(i)?e(t,i):t},s={_em:"em",event_name:"en",protocol_version:"v",_page_id:"_p",_is_debug:"_dbg",tracking_id:"tid",hit_count:"_s",user_id:"uid",client_id:"cid",page_location:"dl",language:"ul",firebase_id:"_fid",traffic_type:"tt",ignore_referrer:"ir",screen_resolution:"sr",global_developer_id_string:"gdid",redact_device_info:"_rdi",geo_granularity:"_geo",_is_passthrough_cid:"gtm_up",_is_linker_valid:"_glv",_user_agent_architecture:"uaa",_user_agent_bitness:"uab",_user_agent_full_version_list:"uafvl",_user_agent_mobile:"uamb",_user_agent_model:"uam",_user_agent_platform:"uap",_user_agent_platform_version:"uapv",_user_agent_wait:"uaW",_user_agent_wow64:"uaw",error_code:"ec",session_id:"sid",session_number:"sct",session_engaged:"seg",page_referrer:"dr",page_title:"dt",currency:"cu",campaign_content:"cc",campaign_id:"ci",campaign_medium:"cm",campaign_name:"cn",campaign_source:"cs",campaign_term:"ck",engagement_time_msec:"_et",event_developer_id_string:"edid",is_first_visit:"_fv",is_new_to_site:"_nsi",is_session_start:"_ss",is_conversion:"_c",euid_mode_enabled:"ecid",non_personalized_ads:"_npa",create_google_join:"gaz",is_consent_update:"gsu",user_ip_address:"uip",google_consent_state:"gcs",google_consent_update:"gcu",us_privacy_string:"uip",document_location:"dl",document_path:"dp",document_title:"dt",document_referrer:"dr",user_language:"ul",document_hostname:"dh",item_id:"id",item_name:"nm",item_brand:"br",item_category:"ca",item_category2:"c2",item_category3:"c3",item_category4:"c4",item_category5:"c5",item_variant:"va",price:"pr",quantity:"qt",coupon:"cp",item_list_name:"ln",index:"lp",item_list_id:"li",discount:"ds",affiliation:"af",promotion_id:"pi",promotion_name:"pn",creative_name:"cn",creative_slot:"cs",location_id:"lo",id:"id",name:"nm",brand:"br",variant:"va",list_name:"ln",list_position:"lp",list:"ln",position:"lp",creative:"cn"},_=["add_payment_info","add_shipping_info","add_to_cart","remove_from_cart","view_cart","begin_checkout","select_item","view_item_list","select_promotion","view_promotion","purchase","refund","view_item","add_to_wishlist"],u=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"browser",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=new URLSearchParams(JSON.parse(JSON.stringify(t))).toString();if("browser"===n){var o;null===(o=navigator)||void 0===o||o.sendBeacon([e,a].join("?"))}else{var r=e.split("://")[0],s=require(r),_={headers:{"User-Agent":i.user_agent},timeout:1},u=s.get([e,a].join("?"),_,(function(e){e.on("data",(function(e){})),e.on("end",(function(){}))})).on("error",(function(e){console.log("Error: "+e.message)}));u.on("timeout",(function(){u.destroy()}))}},c=function(){var e,t;return null!==(e=navigator)&&void 0!==e&&null!==(t=e.userAgentData)&&void 0!==t&&t.getHighEntropyValues?navigator.userAgentData.getHighEntropyValues(["platform","platformVersion","architecture","model","uaFullVersion","bitness","fullVersionList","wow64"]).then((function(e){return{_user_agent_architecture:e.architecture,_user_agent_bitness:e.bitness,_user_agent_full_version_list:encodeURIComponent(e.fullVersionList.map((function(e){return[e.brand,e.version].join(";")})).join("|")),_user_agent_mobile:e.mobile?1:0,_user_agent_model:e.model,_user_agent_platform:e.platform,_user_agent_platform_version:e.platformVersion,_user_agent_wow64:e.wow64?1:0}})):new Promise((function(e){e(null)}))},d=function(){return{page_location:document.location.href,page_referrer:document.referrer,page_title:document.title,language:(navigator&&(navigator.language||navigator.browserLanguage)||"").toLowerCase(),screen_resolution:(window.screen?window.screen.width:0)+"x"+(window.screen?window.screen.height:0)}},l="0.0.1-alpha.1";return function(p){var g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!p)throw"Tracker initialization aborted: missing tracking ids";var f=Object.assign({version:l,debug:!1,mode:o()||"browser",measurement_ids:null,queueDispatchTime:5e3,queueDispatchMaxEvents:10,queue:[],eventParameters:{},persistentEventParameters:{},userProperties:{},user_agent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 [GA4MP/".concat(l,"]"),user_ip_address:null,hooks:{beforeLoad:function(){},beforeRequestSend:function(){}},endpoint:"https://www.google-analytics.com/g/collect",payloadData:{}},g);if(f.payloadData.protocol_version=2,f.payloadData.tracking_id=Array.isArray(p)?p:[p],f.payloadData.client_id=g.client_id?g.client_id:[i(),a()].join("."),f.payloadData._is_debug=g.debug?1:void 0,f.payloadData.non_personalized_ads=g.non_personalized_ads?1:void 0,f.payloadData.hit_count=1,f.payloadData.session_id=g.session_id?g.session_id:a(),f.payloadData.session_number=g.session_number?g.session_number:1,f.payloadData.user_id=g.user_id?e(g.user_id,256):void 0,f.payloadData.user_ip_address=g.user_ip_address?g.user_ip_address:void 0,f.userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 [GA4MP/".concat(l,"]"),"node"===f&&g.user_agent&&(f.user_agent=g.user_agent),"browser"===f.mode){var m=d();m&&(f.payloadData=Object.assign(f.payloadData,m)),c().then((function(e){e&&(f.payloadData=Object.assign(f.payloadData,e))}))}var v=function(){f.queue=[]},y=function(){return f.payloadData.client_id},b=function(){return f.payloadData.session_id},h=function(e,n){if(t(n))try{n=n()}catch(e){}e=r(e,40),n=r(n,100),f.persistentEventParameters[e]=n},w=function(e,t){e=r(e,24),t=r(t,36),f.userProperties[e]=t},D=function(e,t){var i={};1===f.payloadData.hit_count&&(f.payloadData.session_engaged=1),Object.entries(f.payloadData).forEach((function(e){var t=e[0],n=e[1];s[t]&&(i[s[t]]="boolean"==typeof n?+n:n)}));var a=Object.assign(JSON.parse(JSON.stringify(f.persistentEventParameters)),JSON.parse(JSON.stringify(t)));return a.event_name=e,Object.entries(a).forEach((function(t){var a=t[0],o=t[1];if("items"===a&&_.indexOf(e)>-1&&Array.isArray(o))for(var r=o.slice(0,200),u=0;u<r.length;u++)r[u]&&function(){var e={core:{},custom:{}};Object.entries(r[u]).forEach((function(t){s[t[0]]?void 0!==t[1]&&(e.core[s[t[0]]]=t[1]):e.custom[t[0]]=t[1]}));var t=Object.entries(e.core).map((function(e){return e[0]+e[1]})).join("~")+"~"+Object.entries(e.custom).map((function(e,t){var n=10>t?""+t:String.fromCharCode(65+t-10);return"k".concat(n).concat(e[0],"~v").concat(n).concat(e[1])})).join("~");i["pr".concat(u+1)]=t}();else s[a]?i[s[a]]="boolean"==typeof o?+o:o:i[(n(o)?"epn.":"ep.")+a]=o})),Object.entries(f.userProperties).forEach((function(e){var t=e[0],a=e[1];s[t]?i[s[t]]="boolean"==typeof a?+a:a:i[(n(a)?"upn.":"up.")+t]=a})),i},j=function(e){f.payloadData.user_id=r(e,256)},O=function(){return f.payloadData.hit_count},S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=D(e,t);if(i&&n){for(var a=0;a<i.tid.length;a++){var o=JSON.parse(JSON.stringify(i));o.tid=i.tid[a],u(f.endpoint,o,f.mode,{user_agent:null==f?void 0:f.user_agent})}f.payloadData.hit_count++}else{var r=f.queue.push(event);r>=f.queueDispatchMaxEvents&&v()}};return{version:f.version,mode:f.mode,getHitIndex:O,getSessionId:b,getClientId:y,setUserProperty:w,setEventsParameter:h,setUserId:j,trackEvent:S}}}));
//# sourceMappingURL=ga4mp.umd.min.js.map
