{"version":3,"file":"ga4mp.umd.min.js","sources":["../src/modules/helpers.js","../src/modules/ga4Schema.js","../src/modules/request.js","../src/modules/clientHints.js","../src/modules/pageInfo.js","../src/ga4mp.js"],"sourcesContent":["export const trim = (str, chars) => {\r\n    if (typeof str === 'string') {\r\n        return str.substring(0, chars)\r\n    } else {\r\n        return str\r\n    }\r\n}\r\nexport const isFunction = (val) => {\r\n    if (!val) return false\r\n    return (\r\n        Object.prototype.toString.call(val) === '[object Function]' ||\r\n        (typeof val === 'function' &&\r\n            Object.prototype.toString.call(val) !== '[object RegExp]')\r\n    )\r\n}\r\nexport const isNumber = (val) => 'number' === typeof val && !isNaN(val)\r\nexport const isObject = (val) =>\r\n    val != null && typeof val === 'object' && Array.isArray(val) === false\r\nexport const isString = (val) => val != null && typeof val === 'string'\r\nexport const randomInt = () =>\r\n    Math.floor(Math.random() * (2147483647 - 0 + 1) + 0)\r\nexport const timestampInSeconds = () => Math.floor((new Date() * 1) / 1000)\r\nexport const getEnvironment = () => {\r\n    let env\r\n    if (typeof window !== 'undefined' && typeof window.document !== 'undefined')\r\n        env = 'browser'\r\n    else if (\r\n        typeof process !== 'undefined' &&\r\n        process.versions != null &&\r\n        process.versions.node != null\r\n    )\r\n        env = 'node'\r\n    return env\r\n}\r\n/**\r\n * Logger Function\r\n * @param {string} message\r\n * @param {object} data\r\n */\r\n\r\nexport const log = (message, data) => {\r\n    console.log('[GA4MP-LOG]', message, data)\r\n}\r\n\r\n/**\r\n * Populate Page Related Details\r\n */\r\nexport const pageDetails = () => {\r\n    console.log('PAGE DETAIL')\r\n    return {\r\n        page_location: document.location.href,\r\n        page_referrer: document.referrer,\r\n        page_title: document.title,\r\n        language: (\r\n            (navigator && (navigator.language || navigator.browserLanguage)) ||\r\n            ''\r\n        ).toLowerCase(),\r\n        screen_resolution:\r\n            (window.screen ? window.screen.width : 0) +\r\n            'x' +\r\n            (window.screen ? window.screen.height : 0),\r\n    }\r\n}\r\n\r\n/**\r\n * Function to sanitize values based on GA4 Model Limits\r\n * @param {string} val\r\n * @param {integer} maxLength\r\n * @returns\r\n */\r\n\r\nexport const sanitizeValue = (val, maxLength) => {\r\n    // Trim a key-value pair value based on GA4 limits\r\n    /*eslint-disable */\r\n    try {\r\n        val = val.toString()\r\n    } catch (e) {}\r\n    /*eslint-enable */\r\n    if (!isString(val) || !maxLength || !isNumber(maxLength)) return val\r\n    return trim(val, maxLength)\r\n}\r\n","export const ga4Schema = {\r\n    _em: 'em',\r\n    event_name: 'en',\r\n    protocol_version: 'v',\r\n    _page_id: '_p',\r\n    _is_debug: '_dbg',\r\n    tracking_id: 'tid',\r\n    hit_count: '_s',\r\n    user_id: 'uid',\r\n    client_id: 'cid',\r\n    page_location: 'dl',\r\n    language: 'ul',\r\n    firebase_id: '_fid',\r\n    traffic_type: 'tt',\r\n    ignore_referrer: 'ir',\r\n    screen_resolution: 'sr',\r\n    global_developer_id_string: 'gdid',\r\n    redact_device_info: '_rdi',\r\n    geo_granularity: '_geo',\r\n    _is_passthrough_cid: 'gtm_up',\r\n    _is_linker_valid: '_glv',\r\n    _user_agent_architecture: 'uaa',\r\n    _user_agent_bitness: 'uab',\r\n    _user_agent_full_version_list: 'uafvl',\r\n    _user_agent_mobile: 'uamb',\r\n    _user_agent_model: 'uam',\r\n    _user_agent_platform: 'uap',\r\n    _user_agent_platform_version: 'uapv',\r\n    _user_agent_wait: 'uaW',\r\n    _user_agent_wow64: 'uaw',\r\n    error_code: 'ec',\r\n    session_id: 'sid',\r\n    session_number: 'sct',\r\n    session_engaged: 'seg',\r\n    page_referrer: 'dr',\r\n    page_title: 'dt',\r\n    currency: 'cu',\r\n    campaign_content: 'cc',\r\n    campaign_id: 'ci',\r\n    campaign_medium: 'cm',\r\n    campaign_name: 'cn',\r\n    campaign_source: 'cs',\r\n    campaign_term: 'ck',\r\n    engagement_time_msec: '_et',\r\n    event_developer_id_string: 'edid',\r\n    is_first_visit: '_fv',\r\n    is_new_to_site: '_nsi',\r\n    is_session_start: '_ss',\r\n    is_conversion: '_c',\r\n    euid_mode_enabled: 'ecid',\r\n    non_personalized_ads: '_npa',\r\n    create_google_join: 'gaz',\r\n    is_consent_update: 'gsu',\r\n    user_ip_address: 'uip',\r\n    google_consent_state: 'gcs',\r\n    google_consent_update: 'gcu',\r\n    us_privacy_string: 'uip',\r\n    document_location: 'dl',\r\n    document_path: 'dp',\r\n    document_title: 'dt',\r\n    document_referrer: 'dr',\r\n    user_language: 'ul',\r\n    document_hostname: 'dh',\r\n    item_id: 'id',\r\n    item_name: 'nm',\r\n    item_brand: 'br',\r\n    item_category: 'ca',\r\n    item_category2: 'c2',\r\n    item_category3: 'c3',\r\n    item_category4: 'c4',\r\n    item_category5: 'c5',\r\n    item_variant: 'va',\r\n    price: 'pr',\r\n    quantity: 'qt',\r\n    coupon: 'cp',\r\n    item_list_name: 'ln',\r\n    index: 'lp',\r\n    item_list_id: 'li',\r\n    discount: 'ds',\r\n    affiliation: 'af',\r\n    promotion_id: 'pi',\r\n    promotion_name: 'pn',\r\n    creative_name: 'cn',\r\n    creative_slot: 'cs',\r\n    location_id: 'lo',\r\n    // legacy ecommerce\r\n    id: 'id',\r\n    name: 'nm',\r\n    brand: 'br',\r\n    variant: 'va',\r\n    list_name: 'ln',\r\n    list_position: 'lp',\r\n    list: 'ln',\r\n    position: 'lp',\r\n    creative: 'cn',\r\n}\r\n\r\nexport const ecommerceEvents = [\r\n    'add_payment_info',\r\n    'add_shipping_info',\r\n    'add_to_cart',\r\n    'remove_from_cart',\r\n    'view_cart',\r\n    'begin_checkout',\r\n    'select_item',\r\n    'view_item_list',\r\n    'select_promotion',\r\n    'view_promotion',\r\n    'purchase',\r\n    'refund',\r\n    'view_item',\r\n    'add_to_wishlist',\r\n]\r\n","export const sendRequest = (endpoint, payload, mode = 'browser', opts = {}) => {\r\n    const qs = new URLSearchParams(\r\n        JSON.parse(JSON.stringify(payload))\r\n    ).toString()\r\n    if (mode === 'browser') {\r\n        navigator?.sendBeacon([endpoint, qs].join('?'))\r\n    } else {\r\n        const scheme = endpoint.split('://')[0]\r\n        const req = require(scheme)\r\n        const options = {\r\n            headers: {\r\n                'User-Agent': opts.user_agent \r\n            },\r\n            timeout: 1,\r\n        }\r\n        const request = req\r\n            .get([endpoint, qs].join('?'), options, (resp) => {\r\n                let data = ''\r\n                resp.on('data', (chunk) => {\r\n                    data += chunk\r\n                })\r\n                resp.on('end', () => {\r\n                    // TO-DO Handle Server Side Responses                    \r\n                })\r\n            })\r\n            .on('error', (err) => {\r\n                console.log('Error: ' + err.message)\r\n            })\r\n        request.on('timeout', () => {\r\n            request.destroy()\r\n        })\r\n    }\r\n}\r\n","const clientHints = () => {\r\n    if (!navigator?.userAgentData?.getHighEntropyValues)\r\n        return new Promise((resolve) => {\r\n            resolve(null)\r\n        })\r\n    return navigator.userAgentData\r\n        .getHighEntropyValues([\r\n            'platform',\r\n            'platformVersion',\r\n            'architecture',\r\n            'model',\r\n            'uaFullVersion',\r\n            'bitness',\r\n            'fullVersionList',\r\n            'wow64',\r\n        ])\r\n        .then((d) => {\r\n            return {\r\n                _user_agent_architecture: d.architecture,\r\n                _user_agent_bitness: d.bitness,\r\n                _user_agent_full_version_list: encodeURIComponent(\r\n                    d.fullVersionList\r\n                        .map((h) => {\r\n                            return [h.brand, h.version].join(';')\r\n                        })\r\n                        .join('|')\r\n                ),\r\n                _user_agent_mobile: d.mobile ? 1 : 0,\r\n                _user_agent_model: d.model,\r\n                _user_agent_platform: d.platform,\r\n                _user_agent_platform_version: d.platformVersion,\r\n                _user_agent_wow64: d.wow64 ? 1 : 0,\r\n            }\r\n        })\r\n}\r\nexport default clientHints\r\n","/**\r\n * Populate Page Related Details\r\n */\r\nconst pageDetails = () => {\r\n    return {\r\n        page_location: document.location.href,\r\n        page_referrer: document.referrer,\r\n        page_title: document.title,\r\n        language: (\r\n            (navigator && (navigator.language || navigator.browserLanguage)) ||\r\n            ''\r\n        ).toLowerCase(),\r\n        screen_resolution:\r\n            (window.screen ? window.screen.width : 0) +\r\n            'x' +\r\n            (window.screen ? window.screen.height : 0),\r\n    }\r\n}\r\nexport default pageDetails\r\n","import {\r\n    trim,\r\n    isNumber,\r\n    isFunction,\r\n    getEnvironment,\r\n    randomInt,\r\n    timestampInSeconds,\r\n    sanitizeValue,\r\n} from './modules/helpers'\r\n\r\nimport { ga4Schema, ecommerceEvents } from './modules/ga4Schema'\r\nimport { sendRequest } from './modules/request'\r\nimport clientHints from './modules/clientHints'\r\nimport pageDetails from './modules/pageInfo'\r\n\r\nconst version = '0.0.1-alpha.1'\r\n\r\n/**\r\n * Main Class Function\r\n * @param {array|string} measurement_ids\r\n * @param {object} config\r\n * @returns\r\n */\r\n\r\nconst ga4mp = function (measurement_ids, config = {}) {\r\n    if (!measurement_ids)\r\n        throw 'Tracker initialization aborted: missing tracking ids'\r\n    const internalModel = Object.assign(\r\n        {\r\n            version,\r\n            debug: false,\r\n            mode: getEnvironment() || 'browser',\r\n            measurement_ids: null,\r\n            queueDispatchTime: 5000,\r\n            queueDispatchMaxEvents: 10,\r\n            queue: [],\r\n            eventParameters: {},\r\n            persistentEventParameters: {},\r\n            userProperties: {},\r\n            user_agent: `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 [GA4MP/${version}]`,\r\n            user_ip_address: null,\r\n            hooks: {\r\n                beforeLoad: () => {},\r\n                beforeRequestSend: () => {},\r\n            },\r\n            endpoint: 'https://www.google-analytics.com/g/collect',\r\n            payloadData: {},\r\n        },\r\n        config\r\n    )\r\n\r\n    // Initialize Tracker Data\r\n    internalModel.payloadData.protocol_version = 2\r\n    internalModel.payloadData.tracking_id = Array.isArray(measurement_ids)\r\n        ? measurement_ids\r\n        : [measurement_ids]\r\n    internalModel.payloadData.client_id = config.client_id\r\n        ? config.client_id\r\n        : [randomInt(), timestampInSeconds()].join('.')\r\n    internalModel.payloadData._is_debug = config.debug ? 1 : undefined\r\n    internalModel.payloadData.non_personalized_ads = config.non_personalized_ads\r\n        ? 1\r\n        : undefined\r\n    internalModel.payloadData.hit_count = 1\r\n\r\n    // Initialize Session Data\r\n    internalModel.payloadData.session_id = config.session_id\r\n        ? config.session_id\r\n        : timestampInSeconds()\r\n    internalModel.payloadData.session_number = config.session_number\r\n        ? config.session_number\r\n        : 1\r\n\r\n    // Initialize User Data\r\n    internalModel.payloadData.user_id = config.user_id\r\n        ? trim(config.user_id, 256)\r\n        : undefined\r\n    internalModel.payloadData.user_ip_address = config.user_ip_address\r\n        ? config.user_ip_address\r\n        : undefined\r\n    internalModel.userAgent = `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 [GA4MP/${version}]`\r\n\r\n    // Initialize Tracker Data\r\n    if (internalModel === 'node' && config.user_agent) {\r\n        internalModel.user_agent = config.user_agent\r\n    }\r\n    // Grab data only browser data\r\n    if (internalModel.mode === 'browser') {\r\n        const pageData = pageDetails()\r\n        if (pageData) {\r\n            internalModel.payloadData = Object.assign(\r\n                internalModel.payloadData,\r\n                pageData\r\n            )\r\n        }\r\n        clientHints().then((ch) => {\r\n            if (ch) {\r\n                internalModel.payloadData = Object.assign(\r\n                    internalModel.payloadData,\r\n                    ch\r\n                )\r\n            }\r\n        })\r\n    }\r\n    /**\r\n     * Dispatching Queue\r\n     * TO-DO\r\n     */\r\n    const dispatchQueue = () => {\r\n        internalModel.queue = []\r\n    }\r\n\r\n    /**\r\n     * Grab current ClientId\r\n     * @returns string\r\n     */\r\n    const getClientId = () => {\r\n        return internalModel.payloadData.client_id\r\n    }\r\n\r\n    /**\r\n     * Grab current Session ID\r\n     * @returns string\r\n     */\r\n    const getSessionId = () => {\r\n        return internalModel.payloadData.session_id\r\n    }\r\n\r\n    /**\r\n     * Set an Sticky Event Parameter, it wil be attached to all events\r\n     * @param {string} key\r\n     * @param {string|number|Fn} value\r\n     * @returns\r\n     */\r\n    const setEventsParameter = (key, value) => {\r\n        if (isFunction(value)) {\r\n            try {\r\n                value = value()\r\n            } catch (e) {}\r\n        }\r\n        key = sanitizeValue(key, 40)\r\n        value = sanitizeValue(value, 100)\r\n        internalModel['persistentEventParameters'][key] = value\r\n    }\r\n\r\n    /**\r\n     * setUserProperty\r\n     * @param {*} key\r\n     * @param {*} value\r\n     * @returns\r\n     */\r\n    const setUserProperty = (key, value) => {\r\n        key = sanitizeValue(key, 24)\r\n        value = sanitizeValue(value, 36)\r\n        internalModel['userProperties'][key] = value\r\n    }\r\n\r\n    /**\r\n     * Generate Payload\r\n     * @param {object} customEventParameters\r\n     */\r\n    const buildPayload = (eventName, customEventParameters) => {\r\n        const payload = {}\r\n        if (internalModel.payloadData.hit_count === 1)\r\n            internalModel.payloadData.session_engaged = 1\r\n\r\n        Object.entries(internalModel.payloadData).forEach((pair) => {\r\n            const key = pair[0]\r\n            const value = pair[1]\r\n            if (ga4Schema[key]) {\r\n                payload[ga4Schema[key]] =\r\n                    typeof value === 'boolean' ? +value : value\r\n            }\r\n        })\r\n        // GA4 Will have different Limits based on \"unknown\" rules\r\n        // const itemsLimit = isP ? 27 : 10\r\n        const eventParameters = Object.assign(\r\n            JSON.parse(JSON.stringify(internalModel.persistentEventParameters)),\r\n            JSON.parse(JSON.stringify(customEventParameters))\r\n        )\r\n        eventParameters.event_name = eventName\r\n        Object.entries(eventParameters).forEach((pair) => {\r\n            const key = pair[0]\r\n            const value = pair[1]\r\n            if (\r\n                key === 'items' &&\r\n                ecommerceEvents.indexOf(eventName) > -1 &&\r\n                Array.isArray(value)\r\n            ) {\r\n                // only 200 items per event\r\n                let items = value.slice(0, 200)\r\n                for (let i = 0; i < items.length; i++) {\r\n                    if (items[i]) {\r\n                        const item = {\r\n                            core: {},\r\n                            custom: {},\r\n                        }\r\n                        Object.entries(items[i]).forEach((pair) => {\r\n                            if (ga4Schema[pair[0]]) {\r\n                                if (typeof pair[1] !== 'undefined')\r\n                                    item.core[ga4Schema[pair[0]]] = pair[1]\r\n                            } else item.custom[pair[0]] = pair[1]\r\n                        })\r\n                        let productString =\r\n                            Object.entries(item.core)\r\n                                .map((v) => {\r\n                                    return v[0] + v[1]\r\n                                })\r\n                                .join('~') +\r\n                            '~' +\r\n                            Object.entries(item.custom)\r\n                                .map((v, i) => {\r\n                                    var customItemParamIndex =\r\n                                        10 > i\r\n                                            ? '' + i\r\n                                            : String.fromCharCode(65 + i - 10)\r\n                                    return `k${customItemParamIndex}${v[0]}~v${customItemParamIndex}${v[1]}`\r\n                                })\r\n                                .join('~')\r\n                        payload[`pr${i + 1}`] = productString\r\n                    }\r\n                }\r\n            } else {\r\n                if (ga4Schema[key]) {\r\n                    payload[ga4Schema[key]] =\r\n                        typeof value === 'boolean' ? +value : value\r\n                } else {\r\n                    payload[(isNumber(value) ? 'epn.' : 'ep.') + key] = value\r\n                }\r\n            }\r\n        })\r\n        Object.entries(internalModel.userProperties).forEach((pair) => {\r\n            const key = pair[0]\r\n            const value = pair[1]\r\n            if (ga4Schema[key]) {\r\n                payload[ga4Schema[key]] =\r\n                    typeof value === 'boolean' ? +value : value\r\n            } else {\r\n                payload[(isNumber(value) ? 'upn.' : 'up.') + key] = value\r\n            }\r\n        })\r\n        return payload\r\n    }\r\n\r\n    /**\r\n     * setUserId\r\n     * @param {string} value\r\n     * @returns\r\n     */\r\n    const setUserId = (value) => {\r\n        internalModel.payloadData.user_id = sanitizeValue(value, 256)\r\n    }\r\n\r\n    /**\r\n     * Track Event\r\n     * @param {string} eventName\r\n     * @param {object} eventParameters\r\n     * @param {boolean} forceDispatch\r\n     */\r\n    const getHitIndex = () => {\r\n        return internalModel.payloadData.hit_count\r\n    }\r\n    const trackEvent = (\r\n        eventName,\r\n        eventParameters = {},\r\n        sessionControl = {},\r\n        forceDispatch = true\r\n    ) => {\r\n        const payload = buildPayload(eventName, eventParameters, sessionControl)\r\n\r\n        if (payload && forceDispatch) {\r\n            for (let i = 0; i < payload.tid.length; i++) {\r\n                let r = JSON.parse(JSON.stringify(payload))\r\n                r.tid = payload.tid[i]\r\n                sendRequest(internalModel.endpoint, r, internalModel.mode, {\r\n                    user_agent: internalModel?.user_agent,\r\n                })\r\n            }\r\n            internalModel.payloadData.hit_count++\r\n        } else {\r\n            const eventsCount = internalModel.queue.push(event)\r\n            if (eventsCount >= internalModel.queueDispatchMaxEvents) {\r\n                dispatchQueue()\r\n            }\r\n        }\r\n    }\r\n    return {\r\n        version: internalModel.version,\r\n        mode: internalModel.mode,\r\n        getHitIndex,\r\n        getSessionId,\r\n        getClientId,\r\n        setUserProperty,\r\n        setEventsParameter,\r\n        setUserId,\r\n        trackEvent,\r\n    }\r\n}\r\n\r\nexport default ga4mp\r\n"],"names":["trim","str","chars","substring","isFunction","val","Object","prototype","toString","call","isNumber","isNaN","randomInt","Math","floor","random","timestampInSeconds","Date","getEnvironment","env","document","process","versions","node","sanitizeValue","maxLength","e","isString","ga4Schema","_em","event_name","protocol_version","_page_id","_is_debug","tracking_id","hit_count","user_id","client_id","page_location","language","firebase_id","traffic_type","ignore_referrer","screen_resolution","global_developer_id_string","redact_device_info","geo_granularity","_is_passthrough_cid","_is_linker_valid","_user_agent_architecture","_user_agent_bitness","_user_agent_full_version_list","_user_agent_mobile","_user_agent_model","_user_agent_platform","_user_agent_platform_version","_user_agent_wait","_user_agent_wow64","error_code","session_id","session_number","session_engaged","page_referrer","page_title","currency","campaign_content","campaign_id","campaign_medium","campaign_name","campaign_source","campaign_term","engagement_time_msec","event_developer_id_string","is_first_visit","is_new_to_site","is_session_start","is_conversion","euid_mode_enabled","non_personalized_ads","create_google_join","is_consent_update","user_ip_address","google_consent_state","google_consent_update","us_privacy_string","document_location","document_path","document_title","document_referrer","user_language","document_hostname","item_id","item_name","item_brand","item_category","item_category2","item_category3","item_category4","item_category5","item_variant","price","quantity","coupon","item_list_name","index","item_list_id","discount","affiliation","promotion_id","promotion_name","creative_name","creative_slot","location_id","id","name","brand","variant","list_name","list_position","list","position","creative","ecommerceEvents","sendRequest","endpoint","payload","mode","opts","arguments","length","undefined","qs","URLSearchParams","JSON","parse","stringify","_navigator","navigator","sendBeacon","join","scheme","split","req","require","options","headers","user_agent","timeout","request","get","resp","on","chunk","err","console","log","message","destroy","clientHints","_navigator$userAgentD","userAgentData","getHighEntropyValues","then","d","architecture","bitness","encodeURIComponent","fullVersionList","map","h","version","mobile","model","platform","platformVersion","wow64","Promise","resolve","pageDetails","location","href","referrer","title","browserLanguage","toLowerCase","window","screen","width","height","measurement_ids","config","internalModel","assign","debug","queueDispatchTime","queueDispatchMaxEvents","queue","eventParameters","persistentEventParameters","userProperties","concat","hooks","beforeLoad","beforeRequestSend","payloadData","Array","isArray","userAgent","pageData","ch","dispatchQueue","getClientId","getSessionId","setEventsParameter","key","value","setUserProperty","buildPayload","eventName","customEventParameters","entries","forEach","pair","indexOf","items","slice","i","item","core","custom","productString","v","customItemParamIndex","String","fromCharCode","setUserId","getHitIndex","trackEvent","forceDispatch","tid","r","eventsCount","push","event"],"mappings":"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"}