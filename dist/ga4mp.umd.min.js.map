{"version":3,"file":"ga4mp.umd.min.js","sources":["../src/modules/helpers.js","../src/modules/ga4Schema.js","../src/modules/request.js","../src/modules/clientHints.js","../src/modules/pageInfo.js","../src/ga4mp.js"],"sourcesContent":["export const trim = (str, chars) => {\n    if (typeof str === 'string') {\n        return str.substring(0, chars)\n    } else {\n        return str\n    }\n}\nexport const isFunction = (val) => {\n    if (!val) return false\n    return (\n        Object.prototype.toString.call(val) === '[object Function]' ||\n        (typeof val === 'function' &&\n            Object.prototype.toString.call(val) !== '[object RegExp]')\n    )\n}\nexport const isNumber = (val) => 'number' === typeof val && !isNaN(val)\nexport const isObject = (val) =>\n    val != null && typeof val === 'object' && Array.isArray(val) === false\nexport const isString = (val) => val != null && typeof val === 'string'\nexport const randomInt = () =>\n    Math.floor(Math.random() * (2147483647 - 0 + 1) + 0)\nexport const timestampInSeconds = () => Math.floor((new Date() * 1) / 1000)\nexport const getEnvironment = () => {\n    let env\n    if (typeof window !== 'undefined' && typeof window.document !== 'undefined')\n        env = 'browser'\n    else if (\n        typeof process !== 'undefined' &&\n        process.versions != null &&\n        process.versions.node != null\n    )\n        env = 'node'\n    return env\n}\n/**\n * Logger Function\n * @param {string} message\n * @param {object} data\n */\n\nexport const log = (message, data) => {\n    console.log('[GA4MP-LOG]', message, data)\n}\n\n/**\n * Populate Page Related Details\n */\nexport const pageDetails = () => {\n    console.log('PAGE DETAIL')\n    return {\n        page_location: document.location.href,\n        page_referrer: document.referrer,\n        page_title: document.title,\n        language: (\n            (navigator && (navigator.language || navigator.browserLanguage)) ||\n            ''\n        ).toLowerCase(),\n        screen_resolution:\n            (window.screen ? window.screen.width : 0) +\n            'x' +\n            (window.screen ? window.screen.height : 0),\n    }\n}\n\n/**\n * Function to sanitize values based on GA4 Model Limits\n * @param {string} val\n * @param {integer} maxLength\n * @returns\n */\n\nexport const sanitizeValue = (val, maxLength) => {\n    // Trim a key-value pair value based on GA4 limits\n    /*eslint-disable */\n    try {\n        val = val.toString()\n    } catch (e) {}\n    /*eslint-enable */\n    if (!isString(val) || !maxLength || !isNumber(maxLength)) return val\n    return trim(val, maxLength)\n}\n","export const ga4Schema = {\n    _em: 'em',\n    event_name: 'en',\n    protocol_version: 'v',\n    _page_id: '_p',\n    _is_debug: '_dbg',\n    tracking_id: 'tid',\n    hit_count: '_s',\n    user_id: 'uid',\n    client_id: 'cid',\n    page_location: 'dl',\n    language: 'ul',\n    firebase_id: '_fid',\n    traffic_type: 'tt',\n    ignore_referrer: 'ir',\n    screen_resolution: 'sr',\n    global_developer_id_string: 'gdid',\n    redact_device_info: '_rdi',\n    geo_granularity: '_geo',\n    _is_passthrough_cid: 'gtm_up',\n    _is_linker_valid: '_glv',\n    _user_agent_architecture: 'uaa',\n    _user_agent_bitness: 'uab',\n    _user_agent_full_version_list: 'uafvl',\n    _user_agent_mobile: 'uamb',\n    _user_agent_model: 'uam',\n    _user_agent_platform: 'uap',\n    _user_agent_platform_version: 'uapv',\n    _user_agent_wait: 'uaW',\n    _user_agent_wow64: 'uaw',\n    error_code: 'ec',\n    session_id: 'sid',\n    session_number: 'sct',\n    session_engaged: 'seg',\n    page_referrer: 'dr',\n    page_title: 'dt',\n    currency: 'cu',\n    campaign_content: 'cc',\n    campaign_id: 'ci',\n    campaign_medium: 'cm',\n    campaign_name: 'cn',\n    campaign_source: 'cs',\n    campaign_term: 'ck',\n    engagement_time_msec: '_et',\n    event_developer_id_string: 'edid',\n    is_first_visit: '_fv',\n    is_new_to_site: '_nsi',\n    is_session_start: '_ss',\n    is_conversion: '_c',\n    euid_mode_enabled: 'ecid',\n    non_personalized_ads: '_npa',\n    create_google_join: 'gaz',\n    is_consent_update: 'gsu',\n    user_ip_address: 'uip',\n    google_consent_state: 'gcs',\n    google_consent_update: 'gcu',\n    us_privacy_string: 'uip',\n    document_location: 'dl',\n    document_path: 'dp',\n    document_title: 'dt',\n    document_referrer: 'dr',\n    user_language: 'ul',\n    document_hostname: 'dh',\n    item_id: 'id',\n    item_name: 'nm',\n    item_brand: 'br',\n    item_category: 'ca',\n    item_category2: 'c2',\n    item_category3: 'c3',\n    item_category4: 'c4',\n    item_category5: 'c5',\n    item_variant: 'va',\n    price: 'pr',\n    quantity: 'qt',\n    coupon: 'cp',\n    item_list_name: 'ln',\n    index: 'lp',\n    item_list_id: 'li',\n    discount: 'ds',\n    affiliation: 'af',\n    promotion_id: 'pi',\n    promotion_name: 'pn',\n    creative_name: 'cn',\n    creative_slot: 'cs',\n    location_id: 'lo',\n    // legacy ecommerce\n    id: 'id',\n    name: 'nm',\n    brand: 'br',\n    variant: 'va',\n    list_name: 'ln',\n    list_position: 'lp',\n    list: 'ln',\n    position: 'lp',\n    creative: 'cn',\n}\n\nexport const ecommerceEvents = [\n    'add_payment_info',\n    'add_shipping_info',\n    'add_to_cart',\n    'remove_from_cart',\n    'view_cart',\n    'begin_checkout',\n    'select_item',\n    'view_item_list',\n    'select_promotion',\n    'view_promotion',\n    'purchase',\n    'refund',\n    'view_item',\n    'add_to_wishlist',\n]\n","export const sendRequest = (endpoint, payload, mode = 'browser', opts = {}) => {\n    const qs = new URLSearchParams(\n        JSON.parse(JSON.stringify(payload))\n    ).toString()\n    if (mode === 'browser') {\n        navigator?.sendBeacon([endpoint, qs].join('?'))\n    } else {\n        const scheme = endpoint.split('://')[0]\n        const req = require(scheme)\n        const options = {\n            headers: {\n                'User-Agent': opts.user_agent \n            },\n            timeout: 1,\n        }\n        const request = req\n            .get([endpoint, qs].join('?'), options, (resp) => {\n                let data = ''\n                resp.on('data', (chunk) => {\n                    data += chunk\n                })\n                resp.on('end', () => {\n                    // TO-DO Handle Server Side Responses                    \n                })\n            })\n            .on('error', (err) => {\n                console.log('Error: ' + err.message)\n            })\n        request.on('timeout', () => {\n            request.destroy()\n        })\n    }\n}\n","const clientHints = () => {\n    if (!navigator?.userAgentData?.getHighEntropyValues)\n        return new Promise((resolve) => {\n            resolve(null)\n        })\n    return navigator.userAgentData\n        .getHighEntropyValues([\n            'platform',\n            'platformVersion',\n            'architecture',\n            'model',\n            'uaFullVersion',\n            'bitness',\n            'fullVersionList',\n            'wow64',\n        ])\n        .then((d) => {\n            return {\n                _user_agent_architecture: d.architecture,\n                _user_agent_bitness: d.bitness,\n                _user_agent_full_version_list: encodeURIComponent(\n                    d.fullVersionList\n                        .map((h) => {\n                            return [h.brand, h.version].join(';')\n                        })\n                        .join('|')\n                ),\n                _user_agent_mobile: d.mobile ? 1 : 0,\n                _user_agent_model: d.model,\n                _user_agent_platform: d.platform,\n                _user_agent_platform_version: d.platformVersion,\n                _user_agent_wow64: d.wow64 ? 1 : 0,\n            }\n        })\n}\nexport default clientHints\n","/**\n * Populate Page Related Details\n */\nconst pageDetails = () => {\n    return {\n        page_location: document.location.href,\n        page_referrer: document.referrer,\n        page_title: document.title,\n        language: (\n            (navigator && (navigator.language || navigator.browserLanguage)) ||\n            ''\n        ).toLowerCase(),\n        screen_resolution:\n            (window.screen ? window.screen.width : 0) +\n            'x' +\n            (window.screen ? window.screen.height : 0),\n    }\n}\nexport default pageDetails\n","import {\n    trim,\n    isNumber,\n    isFunction,\n    getEnvironment,\n    randomInt,\n    timestampInSeconds,\n    sanitizeValue,\n} from './modules/helpers'\n\nimport { ga4Schema, ecommerceEvents } from './modules/ga4Schema'\nimport { sendRequest } from './modules/request'\nimport clientHints from './modules/clientHints'\nimport pageDetails from './modules/pageInfo'\n\nconst version = '0.0.1-alpha.1'\n\n/**\n * Main Class Function\n * @param {array|string} measurement_ids\n * @param {object} config\n * @returns\n */\n\nconst ga4mp = function (measurement_ids, config = {}) {\n    if (!measurement_ids)\n        throw 'Tracker initialization aborted: missing tracking ids'\n    const internalModel = Object.assign(\n        {\n            version,\n            debug: false,\n            mode: getEnvironment() || 'browser',\n            measurement_ids: null,\n            queueDispatchTime: 5000,\n            queueDispatchMaxEvents: 10,\n            queue: [],\n            eventParameters: {},\n            persistentEventParameters: {},\n            userProperties: {},\n            user_agent: `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 [GA4MP/${version}]`,\n            user_ip_address: null,\n            hooks: {\n                beforeLoad: () => {},\n                beforeRequestSend: () => {},\n            },\n            endpoint: 'https://www.google-analytics.com/g/collect',\n            payloadData: {},\n        },\n        config\n    )\n\n    // Initialize Tracker Data\n    internalModel.payloadData.protocol_version = 2\n    internalModel.payloadData.tracking_id = Array.isArray(measurement_ids)\n        ? measurement_ids\n        : [measurement_ids]\n    internalModel.payloadData.client_id = config.client_id\n        ? config.client_id\n        : [randomInt(), timestampInSeconds()].join('.')\n    internalModel.payloadData._is_debug = config.debug ? 1 : undefined\n    internalModel.payloadData.non_personalized_ads = config.non_personalized_ads\n        ? 1\n        : undefined\n    internalModel.payloadData.hit_count = 1\n\n    // Initialize Session Data\n    internalModel.payloadData.session_id = config.session_id\n        ? config.session_id\n        : timestampInSeconds()\n    internalModel.payloadData.session_number = config.session_number\n        ? config.session_number\n        : 1\n\n    // Initialize User Data\n    internalModel.payloadData.user_id = config.user_id\n        ? trim(config.user_id, 256)\n        : undefined\n    internalModel.payloadData.user_ip_address = config.user_ip_address\n        ? config.user_ip_address\n        : undefined\n    internalModel.userAgent = `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 [GA4MP/${version}]`\n\n    // Initialize Tracker Data\n    if (internalModel === 'node' && config.user_agent) {\n        internalModel.user_agent = config.user_agent\n    }\n    // Grab data only browser data\n    if (internalModel.mode === 'browser') {\n        const pageData = pageDetails()\n        if (pageData) {\n            internalModel.payloadData = Object.assign(\n                internalModel.payloadData,\n                pageData\n            )\n        }\n        clientHints().then((ch) => {\n            if (ch) {\n                internalModel.payloadData = Object.assign(\n                    internalModel.payloadData,\n                    ch\n                )\n            }\n        })\n    }\n    /**\n     * Dispatching Queue\n     * TO-DO\n     */\n    const dispatchQueue = () => {\n        internalModel.queue = []\n    }\n\n    /**\n     * Grab current ClientId\n     * @returns string\n     */\n    const getClientId = () => {\n        return internalModel.payloadData.client_id\n    }\n\n    /**\n     * Grab current Session ID\n     * @returns string\n     */\n    const getSessionId = () => {\n        return internalModel.payloadData.session_id\n    }\n\n    /**\n     * Set an Sticky Event Parameter, it wil be attached to all events\n     * @param {string} key\n     * @param {string|number|Fn} value\n     * @returns\n     */\n    const setEventsParameter = (key, value) => {\n        if (isFunction(value)) {\n            try {\n                value = value()\n            } catch (e) {}\n        }\n        key = sanitizeValue(key, 40)\n        value = sanitizeValue(value, 100)\n        internalModel['persistentEventParameters'][key] = value\n    }\n\n    /**\n     * setUserProperty\n     * @param {*} key\n     * @param {*} value\n     * @returns\n     */\n    const setUserProperty = (key, value) => {\n        key = sanitizeValue(key, 24)\n        value = sanitizeValue(value, 36)\n        internalModel['userProperties'][key] = value\n    }\n\n    /**\n     * Generate Payload\n     * @param {object} customEventParameters\n     */\n    const buildPayload = (eventName, customEventParameters) => {\n        const payload = {}\n        if (internalModel.payloadData.hit_count === 1)\n            internalModel.payloadData.session_engaged = 1\n\n        Object.entries(internalModel.payloadData).forEach((pair) => {\n            const key = pair[0]\n            const value = pair[1]\n            if (ga4Schema[key]) {\n                payload[ga4Schema[key]] =\n                    typeof value === 'boolean' ? +value : value\n            }\n        })\n        // GA4 Will have different Limits based on \"unknown\" rules\n        // const itemsLimit = isP ? 27 : 10\n        const eventParameters = Object.assign(\n            JSON.parse(JSON.stringify(internalModel.persistentEventParameters)),\n            JSON.parse(JSON.stringify(customEventParameters))\n        )\n        eventParameters.event_name = eventName\n        Object.entries(eventParameters).forEach((pair) => {\n            const key = pair[0]\n            const value = pair[1]\n            if (\n                key === 'items' &&\n                ecommerceEvents.indexOf(eventName) > -1 &&\n                Array.isArray(value)\n            ) {\n                // only 200 items per event\n                let items = value.slice(0, 200)\n                for (let i = 0; i < items.length; i++) {\n                    if (items[i]) {\n                        const item = {\n                            core: {},\n                            custom: {},\n                        }\n                        Object.entries(items[i]).forEach((pair) => {\n                            if (ga4Schema[pair[0]]) {\n                                if (typeof pair[1] !== 'undefined')\n                                    item.core[ga4Schema[pair[0]]] = pair[1]\n                            } else item.custom[pair[0]] = pair[1]\n                        })\n                        let productString =\n                            Object.entries(item.core)\n                                .map((v) => {\n                                    return v[0] + v[1]\n                                })\n                                .join('~') +\n                            '~' +\n                            Object.entries(item.custom)\n                                .map((v, i) => {\n                                    var customItemParamIndex =\n                                        10 > i\n                                            ? '' + i\n                                            : String.fromCharCode(65 + i - 10)\n                                    return `k${customItemParamIndex}${v[0]}~v${customItemParamIndex}${v[1]}`\n                                })\n                                .join('~')\n                        payload[`pr${i + 1}`] = productString\n                    }\n                }\n            } else {\n                if (ga4Schema[key]) {\n                    payload[ga4Schema[key]] =\n                        typeof value === 'boolean' ? +value : value\n                } else {\n                    payload[(isNumber(value) ? 'epn.' : 'ep.') + key] = value\n                }\n            }\n        })\n        Object.entries(internalModel.userProperties).forEach((pair) => {\n            const key = pair[0]\n            const value = pair[1]\n            if (ga4Schema[key]) {\n                payload[ga4Schema[key]] =\n                    typeof value === 'boolean' ? +value : value\n            } else {\n                payload[(isNumber(value) ? 'upn.' : 'up.') + key] = value\n            }\n        })\n        return payload\n    }\n\n    /**\n     * setUserId\n     * @param {string} value\n     * @returns\n     */\n    const setUserId = (value) => {\n        internalModel.payloadData.user_id = sanitizeValue(value, 256)\n    }\n\n    /**\n     * Track Event\n     * @param {string} eventName\n     * @param {object} eventParameters\n     * @param {boolean} forceDispatch\n     */\n    const getHitIndex = () => {\n        return internalModel.payloadData.hit_count\n    }\n    const trackEvent = (\n        eventName,\n        eventParameters = {},\n        sessionControl = {},\n        forceDispatch = true\n    ) => {\n        const payload = buildPayload(eventName, eventParameters, sessionControl)\n\n        if (payload && forceDispatch) {\n            for (let i = 0; i < payload.tid.length; i++) {\n                let r = JSON.parse(JSON.stringify(payload))\n                r.tid = payload.tid[i]\n                sendRequest(internalModel.endpoint, r, internalModel.mode, {\n                    user_agent: internalModel?.user_agent,\n                })\n            }\n            internalModel.payloadData.hit_count++\n        } else {\n            const eventsCount = internalModel.queue.push(event)\n            if (eventsCount >= internalModel.queueDispatchMaxEvents) {\n                dispatchQueue()\n            }\n        }\n    }\n    return {\n        version: internalModel.version,\n        mode: internalModel.mode,\n        getHitIndex,\n        getSessionId,\n        getClientId,\n        setUserProperty,\n        setEventsParameter,\n        setUserId,\n        trackEvent,\n    }\n}\n\nexport default ga4mp\n"],"names":["trim","str","chars","substring","isFunction","val","Object","prototype","toString","call","isNumber","isNaN","randomInt","Math","floor","random","timestampInSeconds","Date","getEnvironment","env","document","process","versions","node","sanitizeValue","maxLength","e","isString","ga4Schema","_em","event_name","protocol_version","_page_id","_is_debug","tracking_id","hit_count","user_id","client_id","page_location","language","firebase_id","traffic_type","ignore_referrer","screen_resolution","global_developer_id_string","redact_device_info","geo_granularity","_is_passthrough_cid","_is_linker_valid","_user_agent_architecture","_user_agent_bitness","_user_agent_full_version_list","_user_agent_mobile","_user_agent_model","_user_agent_platform","_user_agent_platform_version","_user_agent_wait","_user_agent_wow64","error_code","session_id","session_number","session_engaged","page_referrer","page_title","currency","campaign_content","campaign_id","campaign_medium","campaign_name","campaign_source","campaign_term","engagement_time_msec","event_developer_id_string","is_first_visit","is_new_to_site","is_session_start","is_conversion","euid_mode_enabled","non_personalized_ads","create_google_join","is_consent_update","user_ip_address","google_consent_state","google_consent_update","us_privacy_string","document_location","document_path","document_title","document_referrer","user_language","document_hostname","item_id","item_name","item_brand","item_category","item_category2","item_category3","item_category4","item_category5","item_variant","price","quantity","coupon","item_list_name","index","item_list_id","discount","affiliation","promotion_id","promotion_name","creative_name","creative_slot","location_id","id","name","brand","variant","list_name","list_position","list","position","creative","ecommerceEvents","sendRequest","endpoint","payload","mode","opts","arguments","length","undefined","qs","URLSearchParams","JSON","parse","stringify","_navigator","navigator","sendBeacon","join","scheme","split","req","require","options","headers","user_agent","timeout","request","get","resp","on","chunk","err","console","log","message","destroy","clientHints","_navigator$userAgentD","userAgentData","getHighEntropyValues","then","d","architecture","bitness","encodeURIComponent","fullVersionList","map","h","version","mobile","model","platform","platformVersion","wow64","Promise","resolve","pageDetails","location","href","referrer","title","browserLanguage","toLowerCase","window","screen","width","height","measurement_ids","config","internalModel","assign","debug","queueDispatchTime","queueDispatchMaxEvents","queue","eventParameters","persistentEventParameters","userProperties","concat","hooks","beforeLoad","beforeRequestSend","payloadData","Array","isArray","userAgent","pageData","ch","dispatchQueue","getClientId","getSessionId","setEventsParameter","key","value","setUserProperty","buildPayload","eventName","customEventParameters","entries","forEach","pair","indexOf","items","slice","i","item","core","custom","productString","v","customItemParamIndex","String","fromCharCode","setUserId","getHitIndex","trackEvent","forceDispatch","tid","r","eventsCount","push","event"],"mappings":"sOAAO,IAAMA,EAAO,SAACC,EAAKC,GACtB,MAAmB,iBAARD,EACAA,EAAIE,UAAU,EAAGD,GAEjBD,CAEf,EACaG,EAAa,SAACC,GACvB,QAAKA,IAEuC,sBAAxCC,OAAOC,UAAUC,SAASC,KAAKJ,IACf,mBAARA,GACoC,oBAAxCC,OAAOC,UAAUC,SAASC,KAAKJ,GAE3C,EACaK,EAAW,SAACL,GAAG,MAAK,iBAAoBA,IAAQM,MAAMN,EAAI,EAI1DO,EAAY,WAAH,OAClBC,KAAKC,iBAAMD,KAAKE,SAAkC,EAAE,EAC3CC,EAAqB,WAAH,OAASH,KAAKC,MAAoB,EAAb,IAAIG,KAAc,IAAK,EAC9DC,EAAiB,WAC1B,IAAIC,EASJ,MARgE,cAA3B,SAAcC,SAC/CD,EAAM,UAEa,oBAAZE,SACa,MAApBA,QAAQC,UACiB,MAAzBD,QAAQC,SAASC,OAEjBJ,EAAM,QACHA,CACX,EAsCaK,EAAgB,SAACnB,EAAKoB,GAG/B,IACIpB,EAAMA,EAAIG,UACD,CAAX,MAAOkB,GAAI,CAEb,OA5DoB,SAACrB,GAAG,OAAY,MAAPA,GAA8B,iBAARA,CAAgB,CA4D9DsB,CAAStB,IAASoB,GAAcf,EAASe,GACvCzB,EAAKK,EAAKoB,GADgDpB,CAErE,EChFauB,EAAY,CACrBC,IAAK,KACLC,WAAY,KACZC,iBAAkB,IAClBC,SAAU,KACVC,UAAW,OACXC,YAAa,MACbC,UAAW,KACXC,QAAS,MACTC,UAAW,MACXC,cAAe,KACfC,SAAU,KACVC,YAAa,OACbC,aAAc,KACdC,gBAAiB,KACjBC,kBAAmB,KACnBC,2BAA4B,OAC5BC,mBAAoB,OACpBC,gBAAiB,OACjBC,oBAAqB,SACrBC,iBAAkB,OAClBC,yBAA0B,MAC1BC,oBAAqB,MACrBC,8BAA+B,QAC/BC,mBAAoB,OACpBC,kBAAmB,MACnBC,qBAAsB,MACtBC,6BAA8B,OAC9BC,iBAAkB,MAClBC,kBAAmB,MACnBC,WAAY,KACZC,WAAY,MACZC,eAAgB,MAChBC,gBAAiB,MACjBC,cAAe,KACfC,WAAY,KACZC,SAAU,KACVC,iBAAkB,KAClBC,YAAa,KACbC,gBAAiB,KACjBC,cAAe,KACfC,gBAAiB,KACjBC,cAAe,KACfC,qBAAsB,MACtBC,0BAA2B,OAC3BC,eAAgB,MAChBC,eAAgB,OAChBC,iBAAkB,MAClBC,cAAe,KACfC,kBAAmB,OACnBC,qBAAsB,OACtBC,mBAAoB,MACpBC,kBAAmB,MACnBC,gBAAiB,MACjBC,qBAAsB,MACtBC,sBAAuB,MACvBC,kBAAmB,MACnBC,kBAAmB,KACnBC,cAAe,KACfC,eAAgB,KAChBC,kBAAmB,KACnBC,cAAe,KACfC,kBAAmB,KACnBC,QAAS,KACTC,UAAW,KACXC,WAAY,KACZC,cAAe,KACfC,eAAgB,KAChBC,eAAgB,KAChBC,eAAgB,KAChBC,eAAgB,KAChBC,aAAc,KACdC,MAAO,KACPC,SAAU,KACVC,OAAQ,KACRC,eAAgB,KAChBC,MAAO,KACPC,aAAc,KACdC,SAAU,KACVC,YAAa,KACbC,aAAc,KACdC,eAAgB,KAChBC,cAAe,KACfC,cAAe,KACfC,YAAa,KAEbC,GAAI,KACJC,KAAM,KACNC,MAAO,KACPC,QAAS,KACTC,UAAW,KACXC,cAAe,KACfC,KAAM,KACNC,SAAU,KACVC,SAAU,MAGDC,EAAkB,CAC3B,mBACA,oBACA,cACA,mBACA,YACA,iBACA,cACA,iBACA,mBACA,iBACA,WACA,SACA,YACA,mBC/GSC,EAAc,SAACC,EAAUC,GAAyC,IAAhCC,yDAAO,UAAWC,EAAOC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAA,CAAA,EAC9DG,EAAK,IAAIC,gBACXC,KAAKC,MAAMD,KAAKE,UAAUV,KAC5BrH,WACF,GAAa,YAATsH,EAAoB,CAAA,IAAAU,EACX,QAATA,EAAAC,iBAAS,IAAAD,GAATA,EAAWE,WAAW,CAACd,EAAUO,GAAIQ,KAAK,KAC9C,KAAO,CACH,IAAMC,EAAShB,EAASiB,MAAM,OAAO,GAC/BC,EAAMC,QAAQH,GACdI,EAAU,CACZC,QAAS,CACL,aAAclB,EAAKmB,YAEvBC,QAAS,GAEPC,EAAUN,EACXO,IAAI,CAACzB,EAAUO,GAAIQ,KAAK,KAAMK,GAAS,SAACM,GAErCA,EAAKC,GAAG,QAAQ,SAACC,GAEjB,IACAF,EAAKC,GAAG,OAAO,WACX,GAEP,IACAA,GAAG,SAAS,SAACE,GACVC,QAAQC,IAAI,UAAYF,EAAIG,QAChC,IACJR,EAAQG,GAAG,WAAW,WAClBH,EAAQS,SACZ,GACJ,CACJ,EChCMC,EAAc,WAAM,IAAAtB,EAAAuB,EACtB,OAAK,QAAAtB,EAAAA,iBAAA,IAAAD,GAAA,QAAAuB,EAAAvB,EAAWwB,qBAAX,IAAAD,GAAAA,EAA0BE,qBAIxBxB,UAAUuB,cACZC,qBAAqB,CAClB,WACA,kBACA,eACA,QACA,gBACA,UACA,kBACA,UAEHC,MAAK,SAACC,GACH,MAAO,CACHlH,yBAA0BkH,EAAEC,aAC5BlH,oBAAqBiH,EAAEE,QACvBlH,8BAA+BmH,mBAC3BH,EAAEI,gBACGC,KAAI,SAACC,GACF,MAAO,CAACA,EAAEtD,MAAOsD,EAAEC,SAAS/B,KAAK,IACrC,IACCA,KAAK,MAEdvF,mBAAoB+G,EAAEQ,OAAS,EAAI,EACnCtH,kBAAmB8G,EAAES,MACrBtH,qBAAsB6G,EAAEU,SACxBtH,6BAA8B4G,EAAEW,gBAChCrH,kBAAmB0G,EAAEY,MAAQ,EAAI,EAEzC,IA/BO,IAAIC,SAAQ,SAACC,GAChBA,EAAQ,KACZ,GA8BR,EC/BMC,EAAc,WAChB,MAAO,CACH5I,cAAelB,SAAS+J,SAASC,KACjCtH,cAAe1C,SAASiK,SACxBtH,WAAY3C,SAASkK,MACrB/I,UACKkG,YAAcA,UAAUlG,UAAYkG,UAAU8C,kBAC/C,IACFC,cACF7I,mBACK8I,OAAOC,OAASD,OAAOC,OAAOC,MAAQ,GACvC,KACCF,OAAOC,OAASD,OAAOC,OAAOE,OAAS,GAEpD,ECFMlB,EAAU,uBASF,SAAUmB,GAA8B,IAAbC,EAAS9D,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAA,CAAA,EAC9C,IAAK6D,EACD,KAAM,uDACV,IAAME,EAAgBzL,OAAO0L,OACzB,CACItB,QAAAA,EACAuB,OAAO,EACPnE,KAAM5G,KAAoB,UAC1B2K,gBAAiB,KACjBK,kBAAmB,IACnBC,uBAAwB,GACxBC,MAAO,GACPC,gBAAiB,CAAE,EACnBC,0BAA2B,CAAE,EAC7BC,eAAgB,CAAE,EAClBrD,WAAU,0HAAAsD,OAA4H9B,EAAU,KAChJzF,gBAAiB,KACjBwH,MAAO,CACHC,WAAY,WAAQ,EACpBC,kBAAmB,WAAO,GAE9B/E,SAAU,6CACVgF,YAAa,CAAC,GAElBd,GAuCJ,GAnCAC,EAAca,YAAY7K,iBAAmB,EAC7CgK,EAAca,YAAY1K,YAAc2K,MAAMC,QAAQjB,GAChDA,EACA,CAACA,GACPE,EAAca,YAAYvK,UAAYyJ,EAAOzJ,UACvCyJ,EAAOzJ,UACP,CAACzB,IAAaI,KAAsB2H,KAAK,KAC/CoD,EAAca,YAAY3K,UAAY6J,EAAOG,MAAQ,OAAI/D,EACzD6D,EAAca,YAAY9H,qBAAuBgH,EAAOhH,qBAClD,OACAoD,EACN6D,EAAca,YAAYzK,UAAY,EAGtC4J,EAAca,YAAYjJ,WAAamI,EAAOnI,WACxCmI,EAAOnI,WACP3C,IACN+K,EAAca,YAAYhJ,eAAiBkI,EAAOlI,eAC5CkI,EAAOlI,eACP,EAGNmI,EAAca,YAAYxK,QAAU0J,EAAO1J,QACrCpC,EAAK8L,EAAO1J,QAAS,UACrB8F,EACN6D,EAAca,YAAY3H,gBAAkB6G,EAAO7G,gBAC7C6G,EAAO7G,qBACPiD,EACN6D,EAAcgB,UAAsIrC,0HAAAA,OAAAA,EAAU,KAGxI,SAAlBqB,GAA4BD,EAAO5C,aACnC6C,EAAc7C,WAAa4C,EAAO5C,YAGX,YAAvB6C,EAAcjE,KAAoB,CAClC,IAAMkF,EAAW9B,IACb8B,IACAjB,EAAca,YAActM,OAAO0L,OAC/BD,EAAca,YACdI,IAGRlD,IAAcI,MAAK,SAAC+C,GACZA,IACAlB,EAAca,YAActM,OAAO0L,OAC/BD,EAAca,YACdK,GAGZ,GACJ,CAKA,IAAMC,EAAgB,WAClBnB,EAAcK,MAAQ,IAOpBe,EAAc,WAChB,OAAOpB,EAAca,YAAYvK,WAO/B+K,EAAe,WACjB,OAAOrB,EAAca,YAAYjJ,YAS/B0J,EAAqB,SAACC,EAAKC,GAC7B,GAAInN,EAAWmN,GACX,IACIA,EAAQA,GACC,CAAX,MAAO7L,GAAI,CAEjB4L,EAAM9L,EAAc8L,EAAK,IACzBC,EAAQ/L,EAAc+L,EAAO,KAC7BxB,EAAyC,0BAAEuB,GAAOC,GAShDC,EAAkB,SAACF,EAAKC,GAC1BD,EAAM9L,EAAc8L,EAAK,IACzBC,EAAQ/L,EAAc+L,EAAO,IAC7BxB,EAA8B,eAAEuB,GAAOC,GAOrCE,EAAe,SAACC,EAAWC,GAC7B,IAAM9F,EAAU,CAAA,EAC4B,IAAxCkE,EAAca,YAAYzK,YAC1B4J,EAAca,YAAY/I,gBAAkB,GAEhDvD,OAAOsN,QAAQ7B,EAAca,aAAaiB,SAAQ,SAACC,GAC/C,IAAMR,EAAMQ,EAAK,GACXP,EAAQO,EAAK,GACflM,EAAU0L,KACVzF,EAAQjG,EAAU0L,IACG,kBAAVC,GAAuBA,EAAQA,EAElD,IAGA,IAAMlB,EAAkB/L,OAAO0L,OAC3B3D,KAAKC,MAAMD,KAAKE,UAAUwD,EAAcO,4BACxCjE,KAAKC,MAAMD,KAAKE,UAAUoF,KA+D9B,OA7DAtB,EAAgBvK,WAAa4L,EAC7BpN,OAAOsN,QAAQvB,GAAiBwB,SAAQ,SAACC,GACrC,IAAMR,EAAMQ,EAAK,GACXP,EAAQO,EAAK,GACnB,GACY,UAARR,GACA5F,EAAgBqG,QAAQL,IAAc,GACtCb,MAAMC,QAAQS,GAId,IADA,IAAIS,EAAQT,EAAMU,MAAM,EAAG,KAClBC,EAAI,EAAGA,EAAIF,EAAM/F,OAAQiG,IAC1BF,EAAME,IAAI,WACV,IAAMC,EAAO,CACTC,KAAM,CAAE,EACRC,OAAQ,CAAC,GAEb/N,OAAOsN,QAAQI,EAAME,IAAIL,SAAQ,SAACC,GAC1BlM,EAAUkM,EAAK,SACQ,IAAZA,EAAK,KACZK,EAAKC,KAAKxM,EAAUkM,EAAK,KAAOA,EAAK,IACtCK,EAAKE,OAAOP,EAAK,IAAMA,EAAK,EACvC,IACA,IAAIQ,EACAhO,OAAOsN,QAAQO,EAAKC,MACf5D,KAAI,SAAC+D,GACF,OAAOA,EAAE,GAAKA,EAAE,EACnB,IACA5F,KAAK,KACV,IACArI,OAAOsN,QAAQO,EAAKE,QACf7D,KAAI,SAAC+D,EAAGL,GACL,IAAIM,EACA,GAAKN,EACC,GAAKA,EACLO,OAAOC,aAAa,GAAKR,EAAI,IACvC,MAAA,IAAA1B,OAAWgC,GAAoBhC,OAAG+B,EAAE,GAAOC,MAAAA,OAAAA,GAAuBD,OAAAA,EAAE,GACxE,IACC5F,KAAK,KACdd,cAAaqG,EAAI,IAAOI,CAAa,CA3B3B,QA+Bd1M,EAAU0L,GACVzF,EAAQjG,EAAU0L,IACG,kBAAVC,GAAuBA,EAAQA,EAE1C1F,GAASnH,EAAS6M,GAAS,OAAS,OAASD,GAAOC,CAGhE,IACAjN,OAAOsN,QAAQ7B,EAAcQ,gBAAgBsB,SAAQ,SAACC,GAClD,IAAMR,EAAMQ,EAAK,GACXP,EAAQO,EAAK,GACflM,EAAU0L,GACVzF,EAAQjG,EAAU0L,IACG,kBAAVC,GAAuBA,EAAQA,EAE1C1F,GAASnH,EAAS6M,GAAS,OAAS,OAASD,GAAOC,CAE5D,IACO1F,GAQL8G,EAAY,SAACpB,GACfxB,EAAca,YAAYxK,QAAUZ,EAAc+L,EAAO,MASvDqB,EAAc,WAChB,OAAO7C,EAAca,YAAYzK,WAE/B0M,EAAa,SACfnB,GAIC,IAHDrB,EAAkBrE,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAA,CAAA,EAElB8G,6DAEMjH,EAAU4F,EAAaC,EAAWrB,GAExC,GAAIxE,GAAWiH,EAAe,CAC1B,IAAK,IAAIZ,EAAI,EAAGA,EAAIrG,EAAQkH,IAAI9G,OAAQiG,IAAK,CACzC,IAAIc,EAAI3G,KAAKC,MAAMD,KAAKE,UAAUV,IAClCmH,EAAED,IAAMlH,EAAQkH,IAAIb,GACpBvG,EAAYoE,EAAcnE,SAAUoH,EAAGjD,EAAcjE,KAAM,CACvDoB,WAAY6C,aAAa,EAAbA,EAAe7C,YAEnC,CACA6C,EAAca,YAAYzK,WAC9B,KAAO,CACH,IAAM8M,EAAclD,EAAcK,MAAM8C,KAAKC,OACzCF,GAAelD,EAAcI,wBAC7Be,GAER,GAEJ,MAAO,CACHxC,QAASqB,EAAcrB,QACvB5C,KAAMiE,EAAcjE,KACpB8G,YAAAA,EACAxB,aAAAA,EACAD,YAAAA,EACAK,gBAAAA,EACAH,mBAAAA,EACAsB,UAAAA,EACAE,WAAAA,EAER"}